<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="icon" type="image/png" href="/static/img/iconSite.png">
    
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    
        <link rel="stylesheet" href="/static/css/base.css">
        <link rel="stylesheet" href="/static/css/windowbuy.css">

        <script type="text/javascript" src="/static/js/Ticket.js"></script>
        <script type="text/javascript" src="/static/js/selectTicket.js"></script>
        
        <title>WayFinder</title>
    </head>
    <body class="container" style="display: flex; width: 1000px">
        <div  style="display: flex;
        background-color: #c2c2c2;
        height: 100%;
        flex-direction: column;
        justify-content: space-between;
        box-shadow: 0px 20px 20px 12px black;">
            <div class="SelectTicket">
                <div class="container SelectTicket">
                    {% for s in iter %}
                        <div class="buyCar">
                            <div>
                                <div class="h3">Билет №{{s + 1}}</div>
                                <div style="font-family:'Times New Roman'; display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: space-around;">
                                    <p>{{transport[s]['start']}}</p>
                                    <p>....</p>
                                    <p>{{transport[s]['end']}}</p>
                                </div>
                                <div style="font-family:'Times New Roman'; margin-top: 6px; margin-left: 5px;"> 
                                    Отправление: {{transport[s]['date-Start']}} {{transport[s]['time-Start']}}
                                    Прибытие: {{transport[s]['date-end']}} {{transport[s]['time-end']}}
                                </div>
                                <div style=" font-family:'Times New Roman'; margin-left: 5px; display: flex; flex-direction: column; margin-top: 7px;">
                                    <p>Количество мест: <span id="countPlace">0</span></p>
                                    <p>Места: <span id="NumberPlace"></span></p>
                                </div>
                                <div style=" font-family:'Times New Roman'; margin-left: 5px; display: flex; flex-direction: column; margin-top: 7px;">
                                    <p>Персональные данные: Не введены</p>
                                </div>
                                <div style="text-align: center; margin-right: 15px;">
                                    <button onclick="SelectTicket(this, 'buy{{s}}')">Изменить</button>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div>Купить</div>
            </div>
            <div class="footer">
                <div class="main-info">
                    <div class="social">
                        <div>
                            <p>Мы в социальных сетях</p>
                            <p>VK</p>
                            <p>TG</p>
                        </div>
                    </div>
                    <div class="document">
                        <div>
                            <p>Документы</p>
                            <p>Разрешение на ведение бизнеса</p>
                            <p>Директор</p>
                            <p>Политика покупки билетов</p>
                        </div>
                    </div>
                    <div class="official-address">
                        <div>
                            <p>Наш адресс: </p>
                            <p>Г. Пермь</p>
                        </div>
                    </div>
                </div>
                <div id="author-code">
                    <p>©️DimaChepushtanov (nick: Ymka)</p>
                </div>
            </div>
        </div>
        
    </body>
    </html>
    {% for i in iter %}
    <div class="modal" id="buy{{i}}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Покупка билета</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="display: flex; flex-direction: row;">
            <div>
                <div>
                    <p>Выберите места: </p>
                </div>
                <div style="display: flex;">
                    <div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">1</div>
                            <div id="place" onclick="SelectPlace(this)">2</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">4</div>
                            <div id="place" onclick="SelectPlace(this)">5</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">9</div>
                            <div id="place" onclick="SelectPlace(this)">10</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">13</div>
                            <div id="place" onclick="SelectPlace(this)">14</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">17</div>
                            <div id="place" onclick="SelectPlace(this)">18</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">21</div>
                            <div id="place" onclick="SelectPlace(this)">22</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">25</div>
                            <div id="place" onclick="SelectPlace(this)">26</div>
                        </div>
                    </div>
                    <div style="margin-left: 50px">
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">3</div>
                            <div id="place" onclick="SelectPlace(this)">4</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">7</div>
                            <div id="place" onclick="SelectPlace(this)">8</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">11</div>
                            <div id="place" onclick="SelectPlace(this)">12</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">15</div>
                            <div id="place" onclick="SelectPlace(this)">16</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">19</div>
                            <div id="place" onclick="SelectPlace(this)">20</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">23</div>
                            <div id="place" onclick="SelectPlace(this)">24</div>
                        </div>
                        <div style="display: flex; flex-direction: row;">
                            <div id="place" onclick="SelectPlace(this)">27</div>
                            <div id="place" onclick="SelectPlace(this)">28</div>
                        </div>
    
                    </div>
                </div>
                
            </div>
            <div class="InfoBUy">
                <div style="font-family:'Times New Roman'; margin-top: 6px; margin-left: 5px;"> 
                    Отправление: 02.02.2024 14:40
                    --------
                    Прибытие: 02.02.2024 12:30
                </div>
                <div style=" font-family:'Times New Roman'; margin-left: 5px; display: flex; flex-direction: column; margin-top: 17px;">
                    <p>Количество мест: <span id="countPlace">0</span></p>
                    <p>Места: <span id="NumberPlace"></span></p>
                    </div>
                <div style=" font-family:'Times New Roman'; margin-left: 5px; display: flex; flex-direction: column; margin-top: 25px;">
                    <p>Персональные данные
                        <a data-bs-toggle="tooltip"  data-bs-placement="top" title="Данные необходимы согласно законам РФ">
                            <svg title="Подсказка внизу" style="margin-top: -12px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="13" height="13"><path d="M6.415.52a2.677 2.677 0 0 1 3.17 0l.928.68c.153.113.33.186.518.215l1.138.175a2.678 2.678 0 0 1 2.241 2.24l.175 1.138c.029.187.102.365.215.518l.68.928a2.677 2.677 0 0 1 0 3.17l-.68.928a1.186 1.186 0 0 0-.215.518l-.175 1.138a2.678 2.678 0 0 1-2.241 2.241l-1.138.175a1.186 1.186 0 0 0-.518.215l-.928.68a2.677 2.677 0 0 1-3.17 0l-.928-.68a1.186 1.186 0 0 0-.518-.215L3.83 14.41a2.678 2.678 0 0 1-2.24-2.24l-.175-1.138a1.186 1.186 0 0 0-.215-.518l-.68-.928a2.677 2.677 0 0 1 0-3.17l.68-.928a1.17 1.17 0 0 0 .215-.518l.175-1.14a2.678 2.678 0 0 1 2.24-2.24l1.138-.175c.187-.029.365-.102.518-.215l.928-.68Zm2.282 1.209a1.18 1.18 0 0 0-1.394 0l-.928.68a2.67 2.67 0 0 1-1.18.489l-1.136.174a1.18 1.18 0 0 0-.987.987l-.174 1.137a2.67 2.67 0 0 1-.489 1.18l-.68.927c-.305.415-.305.98 0 1.394l.68.928c.256.348.423.752.489 1.18l.174 1.136c.078.51.478.909.987.987l1.137.174c.427.066.831.233 1.18.489l.927.68c.415.305.98.305 1.394 0l.928-.68a2.67 2.67 0 0 1 1.18-.489l1.136-.174c.51-.078.909-.478.987-.987l.174-1.137c.066-.427.233-.831.489-1.18l.68-.927c.305-.415.305-.98 0-1.394l-.68-.928a2.67 2.67 0 0 1-.489-1.18l-.174-1.136a1.18 1.18 0 0 0-.987-.987l-1.137-.174a2.67 2.67 0 0 1-1.18-.489ZM6.92 6.085h.001a.75.75 0 0 1-1.342-.67c.169-.339.436-.701.849-.977C6.846 4.16 7.369 4 8 4a2.76 2.76 0 0 1 1.638.525c.502.377.862.965.862 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.109-.073.22-.139.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>
                        </a>
                        :</p>
                    <div class="list-data">
                       
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="SaveTicket('buy{{i}}')">Сохранить</button>
        </div>
      </div>
    </div>
  </div>
    {% endfor %}

      <script>
            function limit(element) {
  var max_chars = 4;

  if(element.value.length > max_chars) {
    element.value = element.value.substr(0, max_chars);
  }
}
function limit2(element) {
  var max_chars = 6;

  if(element.value.length > max_chars) {
    element.value = element.value.substr(0, max_chars);
  }
}
function SelectPlace(place){
    if ($(place).css("background-color") == "rgb(233, 233, 233)"){

        count = $($($(place).parent("div").parent("div").parent("div").parent("div").parent("div").children()[1]).find("#countPlace")).text().trim()
        
        if (count >= 5){
            return 
        }
        count = parseInt(count) + 1

        nowSit = $($($(place).parent("div").parent("div").parent("div").parent("div").parent("div").children()[1]).find("#NumberPlace")).text()
        
        sitplace = $(place).text()
        nowSit == "" ? nowSit += `${sitplace}` : nowSit +=  `, ${sitplace}`

        console.log( count, nowSit)
        $($($(place).parent("div").parent("div").parent("div").parent("div").parent("div").children()[1]).find("#NumberPlace")).html(nowSit)
        $($($(place).parent("div").parent("div").parent("div").parent("div").parent("div").children()[1]).find("#countPlace")).html(count)
        $(place).css({"background-color":"gray"})

        $($($(place).parent("div").parent("div").parent("div").parent("div").parent("div").children()[1]).find(".list-data")).append(`
        <div class="input-group">
                                <span class="input-group-text">Серия и номер документа</span>
                                <input type="number" min="0000" max="9999" aria-label="Seaial" class="form-control" onkey ="limit(this);" onkeyup="limit(this);" style="width: 10px;">
                                <input type="number" aria-label="Number" id="numbere" class="form-control" onkey ="limit2(this);" onkeyup="limit2(this);">
                                <div style="margin: 5px auto; cursor: pointer;" onclick="HaveChild(this)">Ребенок</div>
                                <div class="input-group" id="child" style="margin-left: 30px; margin-top: 10px">
                                    <span class="input-group-text">Серия и номер документа</span>
                                    <input type="number" min="0000" max="9999" aria-label="Seaial" class="form-control" onkey ="limit(this);" onkeyup="limit(this);" style="width: 10px;">
                                    <input type="number" aria-label="Number" id="numbere" class="form-control" onkey ="limit2(this);" onkeyup="limit2(this);">
                                </div>
                            </div>
        `)






    }
    console.log($(place).css("background-color"))
}
function HaveChild(place){
    console.log($(place).parent("div").children()[4])
    $($(place).parent("div").children()[4]).css("display") == "none" ? $($(place).parent("div").children()[4]).css({"display":"flex"}) : $($(place).parent("div").children()[4]).hide()
    }

      </script>